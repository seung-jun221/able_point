<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ν¬μΈνΈ λ±…ν¬ - μ„ μƒλ‹ κ΄€λ¦¬</title>

    <!-- CSS -->
    <link rel="stylesheet" href="../assets/css/common.css" />
    <link rel="stylesheet" href="../assets/css/teacher.css" />

    <!-- DataTables CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css"
    />

    <!-- Toastr CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"
    />

    <style>
      /* Toastr μ»¤μ¤ν„°λ§μ΄μ§• */
      .toast-success {
        background-color: #22c55e !important;
      }
      .toast-error {
        background-color: #ef4444 !important;
      }
      .toast-warning {
        background-color: #f59e0b !important;
      }
      .toast-info {
        background-color: #6366f1 !important;
      }
      #toast-container > div {
        border-radius: 8px !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
      }
    </style>
  </head>
  <body>
    <!-- μ‚¬μ΄λ“λ°” -->
    <div class="sidebar">
      <div class="sidebar-header">
        <!-- λ΅κ³  μμ—­ -->
        <div class="logo-container">
          <div class="logo-image">
            <img src="../assets/images/able-logo.png" alt="μ—μ΄λΈ”μν•™ν•™μ›" />
          </div>
          <div class="logo-subtitle">ν¬μΈνΈλ±…ν¬</div>
        </div>

        <!-- λ° μ„ νƒ μμ—­ -->
        <div class="class-selector-wrapper">
          <label class="class-selector-label">λ° μ„ νƒ</label>
          <select class="class-selector" id="classSelector">
            <option value="">μ „μ²΄ λ°</option>
            <!-- λ™μ  λ΅λ“λ¨ -->
          </select>
        </div>
      </div>

      <nav class="nav-menu">
        <!-- λ€μ‹λ³΄λ“ (λ¨λ“  μ„ μƒλ‹) -->
        <div class="nav-section">
          <a href="index.html" class="nav-item">
            <span class="nav-icon">π“</span>
            <span>λ€μ‹λ³΄λ“</span>
          </a>
        </div>

        <!-- ν¬μΈνΈ κ΄€λ¦¬ (λ¨λ“  μ„ μƒλ‹) -->
        <div class="nav-section">
          <div class="nav-section-title">ν¬μΈνΈ</div>
          <a href="index.html" class="nav-item">
            <span class="nav-icon">π’°</span>
            <span>ν¬μΈνΈ μ§€κΈ‰</span>
          </a>
          <a href="point-history.html" class="nav-item">
            <span class="nav-icon">π“‹</span>
            <span>μ§€κΈ‰ λ‚΄μ—­</span>
          </a>
          <a href="interest-management.html" class="nav-item">
            <span class="nav-icon">π’µ</span>
            <span>μ΄μ μ§€κΈ‰</span>
          </a>
        </div>

        <!-- μƒμ  κ΄€λ¦¬ (λ¨λ“  μ„ μƒλ‹) -->
        <div class="nav-section">
          <div class="nav-section-title">μƒμ </div>
          <a href="purchase-management.html" class="nav-item">
            <span class="nav-icon">π“¦</span>
            <span>κµ¬λ§¤ κ΄€λ¦¬</span>
            <span class="nav-badge" id="pendingBadge" style="display: none"
              >0</span
            >
          </a>
        </div>

        <!-- λ¦¬ν¬νΈ (λ¨λ“  μ„ μƒλ‹) -->
        <div class="nav-section">
          <div class="nav-section-title">λ¦¬ν¬νΈ</div>
          <a href="ranking.html" class="nav-item">
            <span class="nav-icon">π†</span>
            <span>λ­ν‚Ή</span>
          </a>
          <a href="history.html" class="nav-item">
            <span class="nav-icon">π“</span>
            <span>ν¬μΈνΈ λ‚΄μ—­</span>
          </a>
        </div>

        <!-- κ΄€λ¦¬μ μ „μ© λ©”λ‰΄ (μ›μ¥λ§ ν‘μ‹) -->
        <div class="nav-section" id="adminSection" style="display: none">
          <div class="nav-section-title">κ΄€λ¦¬</div>
          <a href="manage.html" class="nav-item">
            <span class="nav-icon">π‘¥</span>
            <span>μ„ μƒλ‹</span>
          </a>
          <a href="classes.html" class="nav-item">
            <span class="nav-icon">π«</span>
            <span>λ° μ„¤μ •</span>
          </a>
          <a href="students.html" class="nav-item">
            <span class="nav-icon">π“</span>
            <span>ν•™μƒ</span>
          </a>
          <a href="shop-manage.html" class="nav-item">
            <span class="nav-icon">π›οΈ</span>
            <span>μƒν’</span>
          </a>
        </div>
      </nav>

      <div class="sidebar-footer">
        <div class="user-info">
          <span class="user-name" id="teacherName">μ„ μƒλ‹</span>
          <span class="user-role" id="userRole">Teacher</span>
        </div>
        <button class="logout-btn" onclick="logout()">
          <span>π</span>
          <span>λ΅κ·Έμ•„μ›ƒ</span>
        </button>
      </div>
    </div>

    <!-- λ©”μΈ μ»¨ν…μΈ  -->
    <div class="main-content">
      <!-- νμ΄μ§€ ν—¤λ” -->
      <div class="page-header">
        <h1 class="page-title">λ€μ‹λ³΄λ“</h1>
        <p class="page-subtitle" id="todayDate">2024λ…„ 11μ›” 15μΌ κΈμ”μΌ</p>
      </div>

      <!-- μ”μ•½ μΉ΄λ“ -->
      <div class="summary-grid">
        <div class="summary-card">
          <div class="summary-icon icon-blue">π‘¥</div>
          <div class="summary-label">μ΄ ν•™μƒ μ</div>
          <div class="summary-value" id="totalStudents">0λ…</div>
          <div class="summary-change">μ „μ²΄ ν•™μƒ</div>
        </div>

        <div
          class="summary-card"
          style="cursor: pointer"
          onclick="location.href='point-history.html'"
        >
          <div class="summary-icon icon-green">π’°</div>
          <div class="summary-label">μ¤λ λ°ν–‰ ν¬μΈνΈ</div>
          <div class="summary-value" id="todayPoints">0P</div>
          <div class="summary-change">μ¤λ μ§€κΈ‰ν• ν¬μΈνΈ β†’</div>
        </div>

        <div class="summary-card">
          <div class="summary-icon icon-purple">π†</div>
          <div class="summary-label">μ΄λ² μ£Ό 1λ“±</div>
          <div class="summary-value" id="weeklyTop">-</div>
          <div class="summary-change" id="weeklyTopPoints">0P νλ“</div>
        </div>

        <div class="summary-card">
          <div class="summary-icon icon-orange">π―</div>
          <div class="summary-label">λ‹¤μ μ΄λ²¤νΈ</div>
          <div class="summary-value">D-14</div>
          <div class="summary-change">μ›”κ°„ κ²½λ§¤</div>
        </div>
      </div>

      <!-- μΌκ΄„ μ•΅μ… μμ—­ -->
      <div
        id="bulkActionArea"
        class="bulk-action-area"
        style="display: none"
      ></div>

      <!-- ν•™μƒ ν…μ΄λΈ” μ„Ήμ… -->
      <div class="table-section">
        <div class="table-header">
          <h3 class="table-title">ν•™μƒ λ©λ΅</h3>
          <div class="table-actions">
            <input
              type="text"
              id="searchInput"
              class="search-box"
              placeholder="ν•™μƒ μ΄λ¦„ κ²€μƒ‰..."
            />
            <button class="btn-point-add" onclick="showPointModal()">
              <span>β•</span> ν¬μΈνΈ μ§€κΈ‰
            </button>
          </div>
        </div>

        <!-- ν•™μƒ ν…μ΄λΈ” -->
        <table id="studentTable" class="student-table">
          <thead id="studentTableHead">
            <tr>
              <!-- μ²΄ν¬λ°•μ¤ μ—΄μ€ JSμ—μ„ μλ™ μ¶”κ°€λ¨ -->
              <th>μ΄λ¦„</th>
              <th>ν•™κΈ‰</th>
              <th>λ λ²¨</th>
              <th>λ³΄μ  ν¬μΈνΈ</th>
              <th>μ €μ¶•</th>
              <th>λΉ λ¥Έ μ•΅μ…</th>
            </tr>
          </thead>
          <tbody id="studentTableBody">
            <!-- μ—¬κΈ°μ— ν•™μƒ λ©λ΅μ΄ λ™μ μΌλ΅ μƒμ„±λ¨ -->
          </tbody>
        </table>
      </div>

      <!-- ν¬μΈνΈ μ§€κΈ‰ λ¨λ‹¬ -->
      <div id="pointModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h2>ν¬μΈνΈ μ§€κΈ‰/μ°¨κ°</h2>
            <button class="modal-close" onclick="closeModal()">β•</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label>λ€μƒ ν•™μƒ</label>
              <select id="modalStudentSelect" class="form-control">
                <option value="">ν•™μƒμ„ μ„ νƒν•μ„Έμ”</option>
                <option value="all">μ „μ²΄ ν•™μƒ</option>
              </select>
            </div>

            <div class="form-group">
              <label>ν¬μΈνΈ ν•­λ©</label>
              <select id="modalPointType" class="form-control">
                <!-- λ™μ μΌλ΅ μƒμ„±λ¨ -->
              </select>
            </div>

            <div class="form-group">
              <label>ν¬μΈνΈ</label>
              <input
                type="number"
                id="modalPointAmount"
                class="form-control"
                placeholder="0"
                min="-9999"
                max="9999"
              />
              <div class="form-hint">μ–‘μλ” μ§€κΈ‰, μμλ” μ°¨κ°</div>
            </div>

            <div class="form-group">
              <label>μ‚¬μ </label>
              <input
                type="text"
                id="modalPointReason"
                class="form-control"
                placeholder="μ‚¬μ λ¥Ό μ…λ ¥ν•μ„Έμ”"
              />
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary" onclick="closeModal()">μ·¨μ†</button>
            <button class="btn-primary" onclick="submitPoints()">ν™•μΈ</button>
          </div>
        </div>
      </div>

      <!-- μ°¨νΈ μ„Ήμ… -->
      <div
        class="charts-section"
        style="
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
          gap: 20px;
          margin: 30px 0;
        "
      >
        <div
          class="chart-card"
          style="
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            min-height: 300px;
            height: 350px;
            position: relative;
          "
        >
          <h3 style="font-size: 16px; margin-bottom: 20px; color: #333">
            π“ μ£Όκ°„ ν¬μΈνΈ λ°κΈ‰ ν„ν™©
          </h3>
          <canvas id="weeklyPointsChart" style="max-height: 250px"></canvas>
        </div>

        <div
          class="chart-card"
          style="
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            height: 350px;
            position: relative;
          "
        >
          <h3 style="font-size: 16px; margin-bottom: 20px; color: #333">
            π¥§ ν•™μƒλ³„ ν¬μΈνΈ λ¶„ν¬
          </h3>
          <canvas id="studentDistributionChart"></canvas>
        </div>

        <!-- μ°¨νΈ μΉ΄λ“ μ¤νƒ€μΌ μμ • -->
        <div
          class="chart-card"
          style="
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            height: 350px;
            position: relative;
          "
        >
          <h3 style="font-size: 16px; margin-bottom: 20px; color: #333">
            π“ μΉ΄ν…κ³ λ¦¬λ³„ ν¬μΈνΈ
          </h3>
          <div style="position: relative; height: 280px">
            <canvas id="categoryChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== μ¤ν¬λ¦½νΈ μ„Ήμ… ========== -->

    <!-- 1. Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- 2. Config & API -->
    <script src="../assets/js/config.js"></script>
    <script src="../assets/js/api.js"></script>

    <!-- 3. jQuery (DataTables, Toastrμ μμ΅΄μ„±) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- 4. DataTables -->
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>

    <!-- 5. Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- 6. Toastr -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

    <!-- 7. Teacher.js (λ©”μΈ λ΅μ§) -->
    <script src="../assets/js/teacher.js"></script>

    <!-- 8. λ€μ‹λ³΄λ“ μ°¨νΈ κ΄€λ¦¬ (μƒλ΅ μ¶”κ°€) -->
    <script src="../assets/js/dashboard-charts.js"></script>
  </body>
</html>
