<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>랭킹 - 포인트 뱅크</title>

    <!-- Supabase & Config -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../assets/js/config.js"></script>
    <script src="../assets/js/api.js"></script>

    <!-- CSS (순서 중요!) -->
    <link rel="stylesheet" href="../assets/css/common.css" />
    <link rel="stylesheet" href="../assets/css/student.css" />
    <link rel="stylesheet" href="../assets/css/navigation.css" />
    <!-- 통일된 네비게이션 CSS 추가 -->
    <link rel="stylesheet" href="../assets/css/ranking.css" />
  </head>
  <body class="with-both-nav">
    <!-- 상하단 네비 클래스 추가 -->

    <!-- 통일된 상단 헤더 (app-header) -->
    <div class="app-header">
      <div class="header-user">
        <div class="header-avatar">
          <div class="header-avatar-inner" id="userAvatar">🦁</div>
        </div>
        <div class="header-name" id="userName">학생 이름</div>
      </div>
      <div class="header-spacer"></div>
      <div class="header-actions">
        <div class="header-points" onclick="location.href='history.html'">
          <span class="header-points-icon">P</span>
          <span class="header-points-value" id="headerTotalPoints">0P</span>
        </div>
        <div class="header-notification" onclick="handleNotificationClick()">
          <span class="notification-icon">🔔</span>
          <span class="notification-badge"></span>
        </div>
      </div>
    </div>

    <!-- 랭킹 탭 (기존 유지) -->
    <div class="ranking-tabs">
      <button class="ranking-tab active" data-tab="accumulated">
        <span>💰</span>
        <span>포인트 랭킹</span>
      </button>
      <button class="ranking-tab" data-tab="weekly">
        <span>🏆</span>
        <span>이번주 스타</span>
      </button>
    </div>

    <!-- 메인 컨테이너 (기존 유지) -->
    <div class="ranking-container">
      <!-- 내 현황 카드 -->
      <div class="my-status-card" id="myStatusCard">
        <!-- 동적 생성 -->
      </div>

      <!-- 랭킹 콘텐츠 -->
      <div id="rankingContent">
        <!-- 동적 생성 -->
      </div>
    </div>

    <!-- 변경할 코드 (SVG 버전) -->
    <nav class="app-nav">
      <a href="index.html" class="nav-item active" data-page="home">
        <span class="nav-icon">
          <svg viewBox="0 0 24 24" width="22" height="22">
            <path
              stroke="currentColor"
              fill="none"
              stroke-width="1.5"
              d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"
            />
            <path
              stroke="currentColor"
              fill="none"
              stroke-width="1.5"
              d="M9 22V12h6v10"
            />
          </svg>
        </span>
        <span class="nav-label">홈</span>
      </a>

      <a href="savings.html" class="nav-item" data-page="savings">
        <span class="nav-icon">
          <svg viewBox="0 0 24 24" width="22" height="22">
            <path
              fill="currentColor"
              d="M19 5h-2V4c0-1.1-.9-2-2-2H9c-1.1 0-2 .9-2 2v1H5c-1.1 0-2 .9-2 2v2c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zM9 4h6v1H9V4zm10 7H5c-.55 0-1-.45-1-1V7c0-.55.45-1 1-1h14c.55 0 1 .45 1 1v3c0 .55-.45 1-1 1z"
            />
            <path
              fill="currentColor"
              d="M4 12v8c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-8H4zm8 4.5c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"
            />
          </svg>
        </span>
        <span class="nav-label">저축</span>
      </a>

      <a href="shop.html" class="nav-item" data-page="shop">
        <span class="nav-icon">
          <svg viewBox="0 0 24 24" width="22" height="22">
            <path
              stroke="currentColor"
              fill="none"
              stroke-width="1.5"
              d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"
            />
            <line
              stroke="currentColor"
              stroke-width="1.5"
              x1="3"
              y1="6"
              x2="21"
              y2="6"
            />
            <path
              stroke="currentColor"
              fill="none"
              stroke-width="1.5"
              d="M16 10a4 4 0 0 1-8 0"
            />
          </svg>
        </span>
        <span class="nav-label">상점</span>
      </a>

      <a href="ranking.html" class="nav-item" data-page="ranking">
        <span class="nav-icon">
          <svg viewBox="0 0 24 24" width="22" height="22">
            <path
              stroke="currentColor"
              fill="none"
              stroke-width="1.5"
              d="M6 9H4.5a2.5 2.5 0 0 1 0-5C5.88 4 7 5.12 7 6.5V9zm0 0h12m0 0h1.5a2.5 2.5 0 0 0 0-5C18.12 4 17 5.12 17 6.5V9z"
            />
            <path
              stroke="currentColor"
              fill="none"
              stroke-width="1.5"
              d="M6 9v10a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V9M10 16h4"
            />
          </svg>
        </span>
        <span class="nav-label">랭킹</span>
      </a>

      <a href="profile.html" class="nav-item" data-page="profile">
        <span class="nav-icon">
          <svg viewBox="0 0 24 24" width="22" height="22">
            <path
              stroke="currentColor"
              fill="none"
              stroke-width="1.5"
              d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"
            />
            <circle
              stroke="currentColor"
              fill="none"
              stroke-width="1.5"
              cx="12"
              cy="7"
              r="4"
            />
          </svg>
        </span>
        <span class="nav-label">내정보</span>
      </a>
    </nav>

    <!-- JavaScript -->
    <script src="../assets/js/navigation.js"></script>
    <!-- 네비게이션 공통 JS 추가 -->
    <script src="../assets/js/ranking.js"></script>

    <!-- 네비게이션 헬퍼 함수 (navigation.js가 없을 경우 대비) -->
    <script>
      // handleNavClick 함수가 없으면 정의
      if (typeof handleNavClick === 'undefined') {
        function handleNavClick(page) {
          event.currentTarget.classList.add('nav-loading');

          setTimeout(() => {
            switch (page) {
              case 'home':
                window.location.href = 'index.html';
                break;
              case 'savings':
                window.location.href = 'savings.html';
                break;
              case 'shop':
                window.location.href = 'shop.html';
                break;
              case 'profile':
                window.location.href = 'profile.html';
                break;
            }
          }, 200);
        }
      }

      // handleNotificationClick 함수가 없으면 정의
      if (typeof handleNotificationClick === 'undefined') {
        function handleNotificationClick() {
          // 알림 페이지로 이동 (또는 알림 모달 표시)
          console.log('알림 클릭');
        }
      }

      // 헤더 정보 업데이트 (기존 ranking.js와 연동)
      document.addEventListener('DOMContentLoaded', () => {
        // 로그인 정보 확인
        const userName = localStorage.getItem('userName');
        const userAvatar = localStorage.getItem('userAvatar');
        const totalPoints = localStorage.getItem('totalPoints');

        // 헤더 업데이트
        if (userName) {
          document.getElementById('userName').textContent = userName;
        }
        if (userAvatar) {
          document.getElementById('userAvatar').textContent = userAvatar;
        }
        if (totalPoints) {
          document.getElementById('headerTotalPoints').textContent =
            parseInt(totalPoints).toLocaleString() + 'P';
        }
      });
    </script>
  </body>
</html>
