<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í¬ì¸íŠ¸ ë±…í¬ - í•™ìƒ</title>
    <link rel="stylesheet" href="../assets/css/common.css" />
    <link rel="stylesheet" href="../assets/css/student.css" />
  </head>
  <body>
    <!-- ìƒë‹¨ í”„ë¡œí•„ í—¤ë” -->
    <div class="profile-header">
      <div class="profile-left">
        <div class="avatar" id="userAvatar">ğŸ¦</div>
        <div class="profile-info">
          <h2 id="userName">í•™ìƒ ì´ë¦„</h2>
          <span class="level-badge" id="userLevel">ğŸŒ± ì”¨ì•—</span>
        </div>
      </div>
      <div class="daily-points">
        <div class="daily-label">ì˜¤ëŠ˜ íšë“</div>
        <div class="daily-value" id="todayPoints">+0P</div>
      </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="main-container">
      <!-- í¬ì¸íŠ¸ ì¹´ë“œ ì„¹ì…˜ (í´ë¦­ ê°€ëŠ¥) -->
      <div
        class="points-section"
        style="cursor: pointer"
        onclick="location.href='history.html'"
      >
        <div class="points-header">
          <div class="points-title">
            <span class="point-icon">P</span>
            <span>í¬ì¸íŠ¸ ì§€ê°‘</span>
          </div>
          <a href="history.html" class="points-link">â€º</a>
        </div>
        <div class="total-points" id="totalPoints">0P</div>
        <div class="points-breakdown">
          <div class="breakdown-item">
            <span class="breakdown-label">ì´ íšë“</span>
            <span class="breakdown-value" id="totalEarned">0P</span>
          </div>
          <div class="breakdown-item">
            <span class="breakdown-label">ì´ ì‚¬ìš©</span>
            <span class="breakdown-value" id="totalSpent">0P</span>
          </div>
        </div>
      </div>

      <!-- íƒ­ ë©”ë‰´ -->
      <div class="tab-menu">
        <button
          class="tab-btn active"
          data-tab="overview"
          onclick="goToHistory('all')"
        >
          ì „ì²´
        </button>
        <button class="tab-btn" data-tab="earn" onclick="goToHistory('earn')">
          íšë“
        </button>
        <button class="tab-btn" data-tab="spend" onclick="goToHistory('spend')">
          ì‚¬ìš©
        </button>
        <button class="tab-btn" data-tab="save" onclick="goToHistory('save')">
          ì €ì¶•
        </button>
      </div>

      <!-- ì €ì¶• ê³„ì¢Œ ì¹´ë“œ (í´ë¦­ ê°€ëŠ¥) -->
      <div
        class="savings-card"
        style="cursor: pointer"
        onclick="location.href='savings.html'"
      >
        <div class="savings-header">
          <span class="savings-title">ğŸ’ ì €ì¶• ê³„ì¢Œ</span>
          <span class="interest-rate">ì£¼ 2% ì´ì</span>
        </div>
        <div class="savings-amount" id="savingsAmount">0P</div>
        <div class="next-interest">
          ë‹¤ìŒ ì´ì ì§€ê¸‰ì¼: <span id="nextInterestDate">ì›”ìš”ì¼</span> (+<span
            id="expectedInterest"
            >0</span
          >P ì˜ˆì •)
        </div>
        <div class="savings-actions" onclick="event.stopPropagation();">
          <button class="savings-btn" onclick="location.href='savings.html'">
            ì…ê¸ˆí•˜ê¸°
          </button>
          <button class="savings-btn" onclick="location.href='savings.html'">
            ì¶œê¸ˆí•˜ê¸°
          </button>
        </div>
      </div>

      <!-- ì´ë²¤íŠ¸ íƒ€ì´ë¨¸ -->
      <div class="event-timer">
        <div class="event-title">ğŸ ë‹¤ìŒ ì›”ê°„ ê²½ë§¤ê¹Œì§€</div>
        <div class="event-countdown" id="eventCountdown">D-14</div>
        <div class="event-date" id="eventDate">11ì›” 29ì¼ ê¸ˆìš”ì¼ 4:30PM</div>
      </div>

      <!-- ë¹ ë¥¸ ì•¡ì…˜ -->
      <div class="quick-actions">
        <div class="action-btn" onclick="location.href='shop.html'">
          <span class="action-icon">ğŸ›ï¸</span>
          <span class="action-label">í¬ì¸íŠ¸ìƒµ</span>
        </div>
        <div class="action-btn" onclick="showGift()">
          <span class="action-icon">ğŸ</span>
          <span class="action-label">ì¹œêµ¬ ì„ ë¬¼</span>
        </div>
        <div class="action-btn" onclick="showDonate()">
          <span class="action-icon">ğŸ’</span>
          <span class="action-label">ê¸°ë¶€í•˜ê¸°</span>
        </div>
        <div class="action-btn" onclick="showMilestone()">
          <span class="action-icon">ğŸ†</span>
          <span class="action-label">ë§ˆì¼ìŠ¤í†¤</span>
        </div>
      </div>

      <!-- ìµœê·¼ í™œë™ -->
      <div class="activity-section">
        <div class="section-header">
          <span class="section-title">ìµœê·¼ í¬ì¸íŠ¸ í™œë™</span>
          <a href="history.html" class="view-all">ì „ì²´ë³´ê¸° â€º</a>
        </div>
        <div class="activity-list" id="activityList">
          <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
      </div>

      <!-- ì´ë²ˆ ì£¼ ë­í‚¹ -->
      <div class="ranking-card">
        <div class="section-header">
          <span class="section-title">ğŸ† ì´ë²ˆ ì£¼ ë­í‚¹</span>
          <a href="ranking.html" class="view-all">ì „ì²´ ë­í‚¹ â€º</a>
        </div>
        <div class="ranking-list" id="rankingList">
          <div class="loading">ë­í‚¹ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
      </div>

      <!-- ì¹œêµ¬ ê¸°ë¶€ í˜„í™© -->
      <div class="donation-section">
        <div class="section-header">
          <span class="section-title">ğŸ’ ì´ë²ˆ ë‹¬ ê¸°ë¶€ ì²œì‚¬ë“¤</span>
        </div>
        <div class="donation-list" id="donationList">
          <div class="donor-card">
            <span class="donor-icon">ğŸ‘¼</span>
            <span class="donor-name">ë°•ë¯¼ìˆ˜</span>
            <span class="donor-amount">300P</span>
          </div>
          <div class="donor-card">
            <span class="donor-icon">ğŸ‘¼</span>
            <span class="donor-name">ì´ì˜í¬</span>
            <span class="donor-amount">200P</span>
          </div>
          <div class="donor-card">
            <span class="donor-icon">ğŸ‘¼</span>
            <span class="donor-name">ìµœì§€ìš°</span>
            <span class="donor-amount">150P</span>
          </div>
        </div>
      </div>
    </div>

    <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="bottom-nav">
      <div class="nav-item active" data-page="home">
        <span class="nav-icon">ğŸ </span>
        <span class="nav-label">í™ˆ</span>
      </div>
      <div
        class="nav-item"
        data-page="savings"
        onclick="location.href='savings.html'"
      >
        <span class="nav-icon">ğŸ’°</span>
        <span class="nav-label">ì €ì¶•</span>
      </div>
      <div
        class="nav-item"
        data-page="shop"
        onclick="location.href='shop.html'"
      >
        <span class="nav-icon">ğŸ›ï¸</span>
        <span class="nav-label">ìƒì </span>
      </div>
      <div
        class="nav-item"
        data-page="ranking"
        onclick="location.href='ranking.html'"
      >
        <span class="nav-icon">ğŸ†</span>
        <span class="nav-label">ë­í‚¹</span>
      </div>
      <div
        class="nav-item"
        data-page="profile"
        onclick="location.href='profile.html'"
      >
        <span class="nav-icon">ğŸ‘¤</span>
        <span class="nav-label">ë‚´ì •ë³´</span>
      </div>
    </div>

    <!-- ëª¨ë‹¬: í¬ì¸íŠ¸ ì„ ë¬¼ -->
    <div id="transferModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modalTitle">í¬ì¸íŠ¸ ì„ ë¬¼í•˜ê¸°</h2>
          <button class="modal-close" onclick="closeModal()">Ã—</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">ë°›ëŠ” ì¹œêµ¬</label>
            <select class="form-select" id="recipientSelect">
              <option value="">ì¹œêµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">ë³´ë‚¼ í¬ì¸íŠ¸</label>
            <input
              type="number"
              class="form-input"
              id="transferAmount"
              placeholder="ë³´ë‚¼ í¬ì¸íŠ¸ ì…ë ¥"
            />
            <div class="form-hint">
              ë³´ìœ  í¬ì¸íŠ¸: <span id="availablePoints">0</span>P
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">ë©”ì‹œì§€ (ì„ íƒ)</label>
            <input
              type="text"
              class="form-input"
              id="transferMessage"
              placeholder="ì‘ì› ë©”ì‹œì§€ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”!"
            />
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closeModal()">ì·¨ì†Œ</button>
          <button class="btn btn-primary" onclick="sendGift()">ì„ ë¬¼í•˜ê¸°</button>
        </div>
      </div>
    </div>

    <!-- ëª¨ë‹¬: ê¸°ë¶€í•˜ê¸° -->
    <div id="donateModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ğŸ’ í¬ì¸íŠ¸ ê¸°ë¶€</h2>
          <button class="modal-close" onclick="closeDonateModal()">Ã—</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">ê¸°ë¶€ ì¢…ë¥˜</label>
            <select class="form-select" id="donationType">
              <option value="school">í•™ì› ë°œì „ ê¸°ë¶€</option>
              <option value="friend">ì–´ë ¤ìš´ ì¹œêµ¬ ë•ê¸°</option>
              <option value="charity">ìì„  ë‹¨ì²´ ê¸°ë¶€</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">ê¸°ë¶€ í¬ì¸íŠ¸</label>
            <input
              type="number"
              class="form-input"
              id="donateAmount"
              placeholder="ê¸°ë¶€í•  í¬ì¸íŠ¸ ì…ë ¥"
            />
            <div class="form-hint">
              ë³´ìœ  í¬ì¸íŠ¸: <span id="donatablePoints">0</span>P
            </div>
          </div>
          <div
            style="
              background: #f0f9ff;
              border-radius: 12px;
              padding: 15px;
              margin-top: 15px;
            "
          >
            <div style="font-size: 13px; color: #0369a1">
              ğŸ’¡ ê¸°ë¶€ ì‹œ ê¸°ë¶€ì²œì‚¬ ëª…ì˜ˆ í¬ì¸íŠ¸ 10%ë¥¼ ì¶”ê°€ë¡œ ë°›ìŠµë‹ˆë‹¤!
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closeDonateModal()">
            ì·¨ì†Œ
          </button>
          <button class="btn btn-primary" onclick="confirmDonate()">
            ê¸°ë¶€í•˜ê¸°
          </button>
        </div>
      </div>
    </div>

    <script src="../assets/js/api.js"></script>
    <script src="../assets/js/student.js"></script>

    <script>
      // ì¶”ê°€ í•¨ìˆ˜ë“¤ - í˜ì´ì§€ ì—°ê²°

      // ê±°ë˜ ë‚´ì—­ í˜ì´ì§€ë¡œ ì´ë™ (í•„í„° ì ìš©)
      function goToHistory(filter) {
        if (filter === 'all') {
          location.href = 'history.html';
        } else {
          location.href = `history.html?filter=${filter}`;
        }
      }

      // ì „ì²´ ë‚´ì—­ ë³´ê¸°
      function showHistory() {
        location.href = 'history.html';
      }

      // ì „ì²´ í™œë™ ë³´ê¸°
      function showAllHistory() {
        location.href = 'history.html';
      }

      // ì¹œêµ¬ ì„ ë¬¼ ëª¨ë‹¬
      function showGift() {
        document.getElementById('transferModal').classList.add('active');
        // ë³´ìœ  í¬ì¸íŠ¸ ì—…ë°ì´íŠ¸
        const currentPoints = studentData?.currentPoints || 0;
        document.getElementById('availablePoints').textContent =
          currentPoints.toLocaleString();
      }

      // ê¸°ë¶€ ëª¨ë‹¬
      function showDonate() {
        document.getElementById('donateModal').classList.add('active');
        // ë³´ìœ  í¬ì¸íŠ¸ ì—…ë°ì´íŠ¸
        const currentPoints = studentData?.currentPoints || 0;
        document.getElementById('donatablePoints').textContent =
          currentPoints.toLocaleString();
      }

      // ê¸°ë¶€ ëª¨ë‹¬ ë‹«ê¸°
      function closeDonateModal() {
        document.getElementById('donateModal').classList.remove('active');
        // ì…ë ¥ ì´ˆê¸°í™”
        document.getElementById('donationType').value = 'school';
        document.getElementById('donateAmount').value = '';
      }

      // ê¸°ë¶€ í™•ì¸
      async function confirmDonate() {
        const type = document.getElementById('donationType').value;
        const amount = parseInt(document.getElementById('donateAmount').value);

        if (!amount || amount <= 0) {
          alert('ê¸°ë¶€í•  í¬ì¸íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }

        if (amount > studentData.currentPoints) {
          alert('í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.');
          return;
        }

        const typeText = {
          school: 'í•™ì› ë°œì „',
          friend: 'ì–´ë ¤ìš´ ì¹œêµ¬ ë•ê¸°',
          charity: 'ìì„  ë‹¨ì²´',
        };

        if (confirm(`${typeText[type]}ì— ${amount}Pë¥¼ ê¸°ë¶€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
          // ì‹¤ì œë¡œëŠ” API í˜¸ì¶œ
          const bonusPoints = Math.floor(amount * 0.1);
          alert(
            `ê¸°ë¶€ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\nê¸°ë¶€ì²œì‚¬ ëª…ì˜ˆ í¬ì¸íŠ¸ ${bonusPoints}Pë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤!`
          );

          // ë°ì´í„° ì—…ë°ì´íŠ¸
          studentData.currentPoints -= amount;
          studentData.currentPoints += bonusPoints;

          closeDonateModal();
          loadStudentData(); // í™”ë©´ ìƒˆë¡œê³ ì¹¨
        }
      }

      // ë§ˆì¼ìŠ¤í†¤ ë³´ê¸°
      function showMilestone() {
        const currentTotal = studentData?.totalPoints || 0;
        const milestones = [
          { level: 'ğŸŒ± ì”¨ì•—', points: 0, reward: 'ê¸°ë³¸' },
          { level: 'ğŸŒ¿ ìƒˆì‹¹', points: 1000, reward: 'ë°°ì§€' },
          { level: 'ğŸŒ³ ë‚˜ë¬´', points: 3000, reward: 'íŠ¹ë³„ ë°°ì§€' },
          { level: 'ğŸŒ² í°ë‚˜ë¬´', points: 5000, reward: 'ë³´ë„ˆìŠ¤ 100P' },
          { level: 'â­ ë³„', points: 10000, reward: 'ë³´ë„ˆìŠ¤ 500P' },
          { level: 'ğŸ’ ë‹¤ì´ì•„ëª¬ë“œ', points: 20000, reward: 'íŠ¹ë³„ ì„ ë¬¼' },
        ];

        let currentLevel = milestones[0];
        let nextLevel = milestones[1];

        for (let i = 0; i < milestones.length; i++) {
          if (currentTotal >= milestones[i].points) {
            currentLevel = milestones[i];
            nextLevel = milestones[i + 1] || null;
          }
        }

        const message = nextLevel
          ? `í˜„ì¬ ë ˆë²¨: ${currentLevel.level}\n` +
            `ëˆ„ì  í¬ì¸íŠ¸: ${currentTotal}P\n\n` +
            `ë‹¤ìŒ ë ˆë²¨: ${nextLevel.level}\n` +
            `í•„ìš” í¬ì¸íŠ¸: ${nextLevel.points - currentTotal}P\n` +
            `ë‹¬ì„± ë³´ìƒ: ${nextLevel.reward}`
          : `ìµœê³  ë ˆë²¨ ë‹¬ì„±! ${currentLevel.level}\nëˆ„ì  í¬ì¸íŠ¸: ${currentTotal}P`;

        alert(message);
      }

      // í”„ë¡œí•„ ë³´ê¸°
      function showProfile() {
        location.href = 'profile.html';
      }

      // ì €ì¶• ê´€ë ¨ í•¨ìˆ˜ë“¤ (savings.htmlë¡œ ì´ë™)
      function deposit() {
        location.href = 'savings.html';
      }

      function withdraw() {
        location.href = 'savings.html';
      }

      // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeModal();
          closeDonateModal();
        }
      });

      // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
      document.querySelectorAll('.modal').forEach((modal) => {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.classList.remove('active');
          }
        });
      });
    </script>
  </body>
</html>
